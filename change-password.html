<!-- change-password.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Change Password</title>
</head>
<body>
  <h2>Change Your Password</h2>
  <form id="changeForm">
    <label>Current Password:</label>
    <input type="password" name="currentPassword" required />

    <label>New Password:</label>
    <input type="password" name="newPassword" required />

    <button type="submit">Change Password</button>
  </form>

  <script src="supabaseClient.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("changeForm");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const currentPassword = formData.get("currentPassword");
        const newPassword = formData.get("newPassword");

        const { data: userData } = await supabase.auth.getUser();
        const email = userData?.user?.email;

        if (!email) {
          alert("You must be logged in to change your password.");
          return;
        }

        const { error: loginError } = await supabase.auth.signInWithPassword({
          email,
          password: currentPassword,
        });

        if (loginError) {
          alert("Incorrect current password.");
          return;
        }

        const { error: updateError } = await supabase.auth.updateUser({
          password: newPassword,
        });

        if (updateError) {
          alert(updateError.message || "Failed to update password.");
        } else {
          alert("Password changed successfully!");
        }
      });
    });
  </script>
</body>
</html>
